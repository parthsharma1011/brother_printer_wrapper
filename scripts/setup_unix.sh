#!/bin/bash\n# Brother QL-700 Label Printer Setup Script for Linux/macOS\n\nset -e  # Exit on any error\n\necho \"ðŸ·ï¸  Brother QL-700 Label Printer Setup\"\necho \"=====================================\\n\"\n\n# Check Python version\nif ! command -v python3 &> /dev/null; then\n    echo \"âŒ Python 3 is required but not installed.\"\n    echo \"Please install Python 3.7 or higher and try again.\"\n    exit 1\nfi\n\nPYTHON_VERSION=$(python3 -c \"import sys; print(f'{sys.version_info.major}.{sys.version_info.minor}')\")\necho \"âœ… Python $PYTHON_VERSION detected\"\n\n# Install Python packages\necho \"\\nðŸ“¦ Installing Python packages...\"\nif command -v pip3 &> /dev/null; then\n    pip3 install -r requirements.txt\nelse\n    python3 -m pip install -r requirements.txt\nfi\n\n# OS-specific setup\nif [[ \"$OSTYPE\" == \"linux-gnu\"* ]]; then\n    echo \"\\nðŸ§ Linux detected - Setting up USB permissions...\"\n    \n    # Install libusb\n    if command -v apt-get &> /dev/null; then\n        echo \"Installing libusb (Ubuntu/Debian)...\"\n        sudo apt-get update\n        sudo apt-get install -y libusb-1.0-0\n    elif command -v dnf &> /dev/null; then\n        echo \"Installing libusb (Fedora/RHEL)...\"\n        sudo dnf install -y libusb\n    elif command -v pacman &> /dev/null; then\n        echo \"Installing libusb (Arch Linux)...\"\n        sudo pacman -S --noconfirm libusb\n    else\n        echo \"âš ï¸  Please install libusb manually for your distribution\"\n    fi\n    \n    # Set up udev rules for Brother QL-700\n    echo \"Setting up USB permissions...\"\n    echo 'SUBSYSTEM==\"usb\", ATTR{idVendor}==\"04f9\", ATTR{idProduct}==\"2042\", MODE=\"0666\", GROUP=\"plugdev\"' | sudo tee /etc/udev/rules.d/99-brother-ql.rules > /dev/null\n    \n    # Reload udev rules\n    sudo udevadm control --reload-rules\n    sudo udevadm trigger\n    \n    # Add user to plugdev group\n    sudo usermod -a -G plugdev $USER\n    \n    echo \"âš ï¸  You may need to log out and log back in for USB permissions to take effect.\"\n    \nelif [[ \"$OSTYPE\" == \"darwin\"* ]]; then\n    echo \"\\nðŸŽ macOS detected - Installing dependencies...\"\n    \n    if command -v brew &> /dev/null; then\n        echo \"Installing libusb via Homebrew...\"\n        brew install libusb\n    else\n        echo \"âš ï¸  Homebrew not found. Please install libusb manually:\"\n        echo \"   Visit: https://brew.sh to install Homebrew\"\n        echo \"   Then run: brew install libusb\"\n    fi\nfi\n\n# Test printer discovery\necho \"\\nðŸ” Testing printer discovery...\"\nif python3 -c \"from webapp import print_utils; printers = print_utils.discover_printers(); print(f'Found {len(printers)} printer(s)')\" 2>/dev/null; then\n    echo \"âœ… Printer discovery working\"\nelse\n    echo \"âš ï¸  Printer discovery test failed (this is normal if no printer is connected)\"\nfi\n\n# Make scripts executable\nchmod +x scripts/*.py 2>/dev/null || true\n\necho \"\\nðŸŽ‰ Setup completed successfully!\"\necho \"\\nðŸ“‹ Next steps:\"\necho \"   1. Connect your Brother QL-700 printer via USB\"\necho \"   2. Test with: python3 scripts/print_labels.py --discover\"\necho \"   3. Start web interface: cd webapp && python3 app.py\"\necho \"   4. Open http://localhost:5000 in your browser\"\necho \"\\nðŸ“š For more help, see README.md\"\n